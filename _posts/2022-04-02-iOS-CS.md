---
title: "iOS Codesigning and Jailbreak"
categories:
  - Blog
tags:
  - Research
  - Jailbreak
---

# iOS Codesigning and Jailbreak
iOS has multiple security measures in it's system to prevent any binary to run in iOS and even control the permissions the binary has in the system.
## Different Measures to bypass in an iOS jailbreak:
<p>In an iOS jailbreak because our goal is to be able to install and run whatever we want on our iOS device, we have to bypass certain measures. iOS works in such a way where hashes and entitlements are pretty important. What's a hash you might say ? Great question, the goal of a hash is to check if a file has been modified, you run a hash function in a file and you should get a string of characters that changes at each modification (example of hash functions: SHA-1, SHA-256, MD5...etc). In a binary there is also it's entitlements in iOS each binary must have entitlements which is pretty self explanatory entitlements are what a binary is allowed to do in the system. Here are the 2 "main" security measures you have to bypass in modern iOS (I'll first present briefly each measure and their respective bypasses):
</p>

## amfid:
### What is it ?
amfid is a system daemon on iOS that runs each time that a binary is run on the system. It checks for each entitlements that the binary has and it checks if the hash of the binary is validated by Apple. 
### How do we bypass it ?
To bypass amfid in modern iOS you have to find a specific function in memory that amfid uses to verify file hashes, called: MISValidateSignatureAndCopyInfo. We then setup an exception handler, because we are gonna make amfid crash by overwriting that function. When you crash that function we can "catch" that error with our exception handler and tell amfid that the hash for the file is good to go. So to bypass amfid you need to setup a daemon that will run the exception handler for you and tell amfid every file is good to go. To sum up here's a little explanatory diagram:
User runs binary -> amfid get's called -> amfid *crashes* when it want's to check the binary with the MISValidateSignatureAndCopyInfo function that we've overwritten in memory -> our exception handler controls that crash and tell amfid everything is fine and he can continue.
I feel like this GIF describes this situation well:
<iframe src="https://giphy.com/embed/l2JIlnyZUpduiAn6M" width="480" height="474" frameBorder="0" class="giphy-embed" allowFullScreen></iframe><p><a href="https://giphy.com/gifs/justin-grease-live-faint-swoon-l2JIlnyZUpduiAn6M">via GIPHY</a></p>
- CoreTrust:
TBD

